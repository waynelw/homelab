apiVersion: v1
kind: Pod
metadata:
  name: lifecycle-demo
  namespace: experiments
  labels:
    app: lifecycle-demo
spec:
  containers:
  - name: main
    image: nginx:alpine
    lifecycle:
      postStart:
        exec:
          command: ["/bin/sh", "-c", "echo 'PostStart: Pod started at $(date)' > /usr/share/nginx/html/lifecycle.log"]
      preStop:
        exec:
          command: ["/bin/sh", "-c", "sleep 10 && echo 'PreStop: Pod stopping at $(date)' >> /usr/share/nginx/html/lifecycle.log"]
    livenessProbe:
      httpGet:
        path: /
        port: 80
      initialDelaySeconds: 3
      periodSeconds: 5
    readinessProbe:
      httpGet:
        path: /
        port: 80
      initialDelaySeconds: 2
      periodSeconds: 3
